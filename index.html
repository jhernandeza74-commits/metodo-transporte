<!-- index.html -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#4CAF50">
  <link rel="manifest" href="manifest.json">
  <title>MÃ©todo de Transporte</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
    h1 { text-align: center; }
    .input-box { margin-bottom: 15px; }
    label { display: block; font-weight: bold; margin-bottom: 5px; }
    input, textarea, button {
      width: 100%; padding: 10px; margin-bottom: 10px;
      border: 1px solid #ccc; border-radius: 5px;
    }
    button { background: #4CAF50; color: white; font-size: 16px; cursor: pointer; }
    button:hover { background: #45a049; }
    #resultado { background: white; padding: 15px; border-radius: 5px; white-space: pre-wrap; }
    .error { border: 2px solid red; background: #ffe6e6; }
    #installBtn {
      display: none;
      background: #2196F3;
      margin-bottom: 20px;
    }
    #installBtn:hover {
      background: #0b7dda;
    }
  </style>
</head>
<body>

  <button id="installBtn" onclick="instalarApp()">ðŸ“¥ Instalar App</button>

  <h1>MÃ©todo de Transporte</h1>

  <div class="input-box">
    <label for="oferta">Oferta:</label>
    <input type="text" id="oferta" placeholder="Ej: 20 30 25">
  </div>

  <div class="input-box">
    <label for="demanda">Demanda:</label>
    <input type="text" id="demanda" placeholder="Ej: 10 25 20 20">
  </div>

  <div class="input-box">
    <label for="costos">Matriz de costos:</label>
    <textarea id="costos" rows="3" placeholder="Ej: 8 6 10 9; 9 12 13 7; 14 9 16 5"></textarea>
  </div>

  <button onclick="calcular()">Calcular</button>

  <h2>Resultado:</h2>
  <div id="resultado">AquÃ­ aparecerÃ¡ el paso a paso...</div>

  <script>
    // Registrar Service Worker
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("sw.js")
        .then(() => console.log("âœ… Service Worker registrado"))
        .catch(error => console.error("âŒ Error al registrar Service Worker:", error));
    }

    // Variables para almacenamiento en memoria
    let datosGuardados = {
      oferta: "",
      demanda: "",
      costos: ""
    };

    // Recuperar datos guardados
    document.getElementById("oferta").value = datosGuardados.oferta;
    document.getElementById("demanda").value = datosGuardados.demanda;
    document.getElementById("costos").value = datosGuardados.costos;

    function calcular() {
      let ofertaInput = document.getElementById("oferta");
      let demandaInput = document.getElementById("demanda");
      let costosInput = document.getElementById("costos");
      let resultadoDiv = document.getElementById("resultado");

      ofertaInput.classList.remove("error");
      demandaInput.classList.remove("error");
      costosInput.classList.remove("error");

      try {
        datosGuardados.oferta = ofertaInput.value;
        datosGuardados.demanda = demandaInput.value;
        datosGuardados.costos = costosInput.value;

        let oferta = ofertaInput.value.trim().split(/\s+/).map(Number);
        let demanda = demandaInput.value.trim().split(/\s+/).map(Number);
        let filas = costosInput.value.trim().split(";");
        let costos = filas.map(f => f.trim().split(/\s+/).map(Number));

        if (costos.length !== oferta.length || costos[0].length !== demanda.length) {
          costosInput.classList.add("error");
          resultadoDiv.textContent = "âŒ Las dimensiones de la matriz de costos no coinciden con oferta y demanda.";
          return;
        }

        let resultado = esquinaNoroestePasoAPaso(oferta, demanda, costos);
        resultadoDiv.textContent = resultado;

      } catch (e) {
        ofertaInput.classList.add("error");
        demandaInput.classList.add("error");
        costosInput.classList.add("error");
        resultadoDiv.textContent = "âŒ Error en los datos ingresados. Verifica el formato.";
      }
    }

    function esquinaNoroestePasoAPaso(oferta, demanda, costos) {
      let asignacion = Array.from({length: oferta.length}, () => Array(demanda.length).fill(0));
      let ofertaRestante = [...oferta];
      let demandaRestante = [...demanda];

      let sb = "ðŸ“¦ Paso a paso del mÃ©todo de la esquina noroeste:\n\n";
      let i = 0, j = 0;

      while (i < oferta.length && j < demanda.length) {
        let cantidad = Math.min(ofertaRestante[i], demandaRestante[j]);
        asignacion[i][j] = cantidad;

        sb += Asigno ${cantidad} unidades desde Origen ${i+1} a Destino ${j+1} (costo ${costos[i][j]})\n;

        ofertaRestante[i] -= cantidad;
        demandaRestante[j] -= cantidad;

        if (ofertaRestante[i] === 0) {
          sb += â†’ Oferta del Origen ${i+1} agotada.\n\n;
          i++;
        } else {
          sb += â†’ Demanda del Destino ${j+1} satisfecha.\n\n;
          j++;
        }
      }

      sb += "âœ… Asignaciones finales:\n";
      let costoTotal = 0;
      for (i = 0; i < oferta.length; i++) {
        for (j = 0; j < demanda.length; j++) {
          if (asignacion[i][j] > 0) {
            sb += Origen ${i+1} â†’ Destino ${j+1}: ${asignacion[i][j]} unidades (costo ${costos[i][j]})\n;
            costoTotal += asignacion[i][j] * costos[i][j];
          }
        }
      }
      sb += \nðŸ’° Costo total = ${costoTotal};
      return sb;
    }

    // PWA Install
    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.style.display = 'block';
    });

    function instalarApp() {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then((choiceResult) => {
          if (choiceResult.outcome === 'accepted') {
            console.log('âœ… App instalada');
          }
          deferredPrompt = null;
          installBtn.style.display = 'none';
        });
      }
    }

    window.addEventListener('appinstalled', () => {
      console.log('âœ… PWA instalada');
      installBtn.style.display = 'none';
    });
  </script>
</body>
</html>
